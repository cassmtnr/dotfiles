# Create a directory and cd into it
mkd() {
    mkdir -p "$@" && cd "$@"
}

# Kill process running on specified port
killport() {
    if [[ -z "$1" ]]; then
        echo "Usage: killport <port>"
        return 1
    fi
    lsof -t -i tcp:"$1" | xargs kill 2>/dev/null || echo "No process found on port $1"
}

# Get weather for a location
weather() {
    curl -s "wttr.in/${1}"
}

# Extract various archive formats
extract() {
    if [[ -f "$1" ]]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       unrar e "$1"     ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        7z x "$1"        ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}


# Playwright install helper (for work environments with proxy)
playwright-install() {
    if [[ -z "$1" ]]; then
        echo "Usage: playwright-install <proxy-url>"
        return 1
    fi
    HTTPS_PROXY="http://$1" npx playwright install
}


# Claude Flow helper function
flow() {
    # Check if claude-flow is installed
    if ! command -v claude-flow &> /dev/null; then
        echo "Error: claude-flow is not installed"
        echo "Install with: npm install -g claude-flow"
        return 1
    fi

    if [[ "$1" == "start" ]]; then
        # Start hive-mind with optional objective
        if [[ -n "$2" ]]; then
            claude-flow hive-mind spawn --objective "$2" --claude
        else
            claude-flow hive-mind spawn --claude
        fi
    elif [[ "$1" == "init" ]] && [[ -n "$2" ]]; then
        claude-flow create --force --project-name="$2"
    elif [[ "$1" == "resume" ]]; then
        # Resume from .claude-flow:session file or provided session ID
        if [[ -n "$2" ]]; then
            # Resume specific session by ID
            claude-flow hive-mind resume "$2" --claude
        elif [[ -f ".claude-flow:session" ]]; then
            # Resume from session file in current directory
            local session_name=$(cat .claude-flow:session)
            echo "Resuming session: $session_name"
            claude-flow hive-mind resume "$session_name" --claude
        else
            echo "No .claude-flow:session file found in current directory"
            echo "Usage: flow resume [session-id]"
            return 1
        fi
    elif [[ "$1" == "wizard" ]]; then
        claude-flow hive-mind wizard
    elif [[ "$1" == "status" ]]; then
        claude-flow hive-mind status
    else
        echo "Usage:"
        echo "  flow start [objective]       - Start hive-mind with optional objective"
        echo "  flow init <project-name>     - Initialize a new project"
        echo "  flow resume                  - Resume from .claude-flow:session file"
        echo "  flow resume <session-id>     - Resume specific session by ID"
        echo "  flow wizard                  - Run hive-mind wizard"
        echo "  flow status                  - Check hive-mind status"
        echo ""
        echo "Examples:"
        echo "  flow start"
        echo "  flow start 'Analyze the codebase'"
        echo "  flow init my-app"
        echo "  flow resume"
        echo "  flow resume session-12345"
        echo "  flow wizard"
    fi
}